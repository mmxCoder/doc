"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["532"],{8829:function(e,n,s){s.r(n),s.d(n,{default:()=>l});let r=s("5893"),d=s("65"),t=s("6685"),i=s.p+"static/image/servernotify1.0de2d088.png",a=s.p+"static/image/servernotify2.82fadb75.png";function c(e){let n=Object.assign({h1:"h1",a:"a",div:"div",p:"p",h2:"h2",blockquote:"blockquote",h3:"h3",h4:"h4",pre:"pre",code:"code",h5:"h5",ol:"ol",li:"li",strong:"strong"},(0,d.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"\u670D\u52A1\u7AEF\u901A\u77E5",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u670D\u52A1\u7AEF\u901A\u77E5",children:"#"}),"\u670D\u52A1\u7AEF\u901A\u77E5"]}),"\n",(0,r.jsxs)(n.div,{className:"rspress-directive tip",children:[(0,r.jsx)(n.div,{className:"rspress-directive-title",children:"\u63D0\u793A"}),(0,r.jsx)(n.div,{className:"rspress-directive-content",children:(0,r.jsxs)(n.p,{children:["\n\u8FD9\u91CC\u53EA\u505A\u670D\u52A1\u7AEF\u4E3B\u52A8\u901A\u77E5\u7684\u65B9\u6848, \u5C31\u4E0D\u8BF4\u660E ",(0,r.jsx)(t.Z,{color:"red",children:"\u8F6E\u8BE2"}),"\u7684\u65B9\u6848\u4E86, \u56E0\u4E3A\u8FD9\u4E2A\u65B9\u6848\u5DF2\u7ECF\u8FC7\u65F6\u4E86."]})})]}),"\n",(0,r.jsxs)(n.h2,{id:"server-sent-events-sse",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#server-sent-events-sse",children:"#"}),"Server-Sent Events (SSE)"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8FD9\u662F\u4E00\u79CD\u5728\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u4E4B\u95F4\u5B9E\u73B0\u5355\u5411\u4E8B\u4EF6\u6D41\u7684\u673A\u5236\uFF0C\u5141\u8BB8\u670D\u52A1\u5668\u4E3B\u52A8\u5411\u5BA2\u6237\u7AEF\u53D1\u9001\u4E8B\u4EF6\u6570\u636E\u3002\u5728 SSE \u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528\u81EA\u5B9A\u4E49\u4E8B\u4EF6\uFF08Custom Events\uFF09\u6765\u53D1\u9001\u5177\u6709\u7279\u5B9A\u7C7B\u578B\u7684\u4E8B\u4EF6\u6570\u636E\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"\u5B9E\u73B0",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B9E\u73B0",children:"#"}),"\u5B9E\u73B0"]}),"\n",(0,r.jsxs)(n.h4,{id:"\u540E\u7AEFnodejs",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u540E\u7AEFnodejs",children:"#"}),"\u540E\u7AEF(nodejs)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"{2-3}",children:'app.get("/sse", (req, res) => {\n  // \u53EA\u9700\u8981\u52A0\u4E0A\u8FD9\u4E00\u884C\u5C31\u53EF\u4EE5\u4E86.\n  res.setHeader("Content-Type", "text/event-stream");\n  res.status(200);\n\n  setInterval(() => {\n    // \u8FD9\u91CC\u662F\u53EF\u4EE5\u81EA\u5B9A\u4E49\u4E8B\u4EF6\n    // \u5728\u8FD9\u91CC \u524D\u7AEF\u53EF\u4EE5\u76D1\u542C hello \u548C world \u4E8B\u4EF6\n    res.write("event:" + (Math.random() > 0.5 ? "hello" : "world") + "\\n");\n    res.write("data: " + new Date().getTime() + "\\n\\n");\n\n  }, 1000);\n});\n'})}),"\n",(0,r.jsxs)(n.h5,{id:"\u8BF4\u660E",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u8BF4\u660E",children:"#"}),"\u8BF4\u660E"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53D1\u9001\u7ED9\u5BA2\u6237\u7AEF\u7684\u5F62\u5F0F\u90FD\u662F\u4EE5 ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"[field]: value"})})," \u7684\u5F62\u5F0F\u7F16\u5199\u7684. \u8FD9\u91CC\u7684 ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"field"})})," \u53D6\u503C\u5982\u4E0B:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"",children:"\n[field]\n    event: \u81EA\u5B9A\u4E49\u4E8B\u4EF6\n    data: \u6570\u636E\u6E90\n    id: \u8FD9\u662F\u4E00\u4E2A\u6807\u8BC6, \u5F53\u53D1\u751F\u9519\u8BEF\u65AD\u5F00\u94FE\u63A5\u65F6, \u5BA2\u6237\u7AEF\u4F1A\u81EA\u52A8\u643A\u5E26\u8FD9\u4E2Aid\u53D1\u9001\u5230\u670D\u52A1\u7AEF.\n    retry: \u6307\u5B9A\u6D4F\u89C8\u5668\u91CD\u65B0\u53D1\u8D77\u8FDE\u63A5\u7684\u65F6\u95F4\u95F4\u9694.\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8BF7\u6CE8\u610F: \u5728\u4E00\u4E2A\u4E8B\u4EF6\u5185, \u6BCF\u6B21\u6307\u5B9A\u6570\u636E\u540E\u90FD\u9700\u8981\u52A0\u4E0A ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"\\n"})})," \u7ED3\u5C3E. \u6700\u540E\u4E00\u4E2A\u4F7F\u7528 ",(0,r.jsx)(n.strong,{children:"\\n\\n"})," \u7ED3\u5C3E."]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u5173\u4E8E\u4E0A\u9762\u7684 id \u548C retry \u5B57\u6BB5, \u5982\u679C\u4F60\u60F3\u770B\u5230\u5B9E\u9645\u6548\u679C, \u53EF\u4EE5\u8FD9\u6837."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"",children:'\n// node\n\napp.get("/sse", (req, res) => {\n  res.setHeader("Content-Type", "text/event-stream");\n  res.status(200);\n  // \u8BBE\u7F6Eid.\n  res.write(\'id: 111\\n\')\n  // \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4, \u8FC7\u671F\u53EF\u80FD\u56FE\u7247\u53EF\u80FD\u4F53\u73B0\u4E0D\u51FA\u6765, \u53EF\u4EE5\u81EA\u884C\u5C1D\u8BD5\n  // \u4F1A\u53D1\u73B0\u91CD\u8FDE\u5931\u8D25\u540E500\u6BEB\u79D2\u53C8\u4F1A\u7ACB\u5373\u91CD\u8FDE.\n  res.write("retry: 500\\n");\n\n  res.write(\'data: 222\\n\\n\')\n});\n\n'})}),"\n",(0,r.jsx)("img",{src:i}),"\n",(0,r.jsxs)(n.h4,{id:"\u524D\u7AEF",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u524D\u7AEF",children:"#"}),"\u524D\u7AEF"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"{1}",children:"const sse = new EventSource('http://localhost:3001/sse')\n\n// \u76D1\u542C\u901A\u7528\u4E8B\u4EF6\nsee.addEventListener('message', () => {})\n// \u76D1\u542C\u81EA\u5B9A\u4E49\u4E8B\u4EF6\nsse.addEventListener('hello', () => {})\n// \u76D1\u542C\u9519\u8BEF\u4E8B\u4EF6\nsse.addEventListener('error', () => {})\n\n// \u624B\u52A8\u5173\u95ED\u8FDE\u63A5\nsse.close()\n\n"})}),"\n",(0,r.jsxs)(n.h5,{id:"\u8BF4\u660E-1",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u8BF4\u660E-1",children:"#"}),"\u8BF4\u660E:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u5F53\u53D1\u751F\u9519\u8BEF\u65AD\u5F00\u94FE\u63A5\u65F6, sse\u4F1A\u81EA\u52A8\u8FDB\u884C\u91CD\u8FDE, \u5982\u679C\u4F60\u60F3\u963B\u6B62\u91CD\u8FDE, \u53EF\u4EE5\u8FD9\u4E48\u505A:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"",children:"\nsse.addEventListener('error', () => {\n    // TODO: \u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u5173\u95ED\u8BE5\u8FDE\u63A5, \u5C31\u4E0D\u4F1A\u91CD\u8FDE\u4E86.\n    sse.close()\n})\n\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"\u6848\u4F8B\u5730\u5740",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6848\u4F8B\u5730\u5740",children:"#"}),"\u6848\u4F8B\u5730\u5740"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/mmxCoder/demo/tree/main/sse",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/mmxCoder/demo/tree/main/sse"})}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"websocket",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#websocket",children:"#"}),"websocket"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8FD9\u662F\u4E00\u79CD\u53CC\u5168\u5DE5\u7684\u534F\u8BAE, \u4E0ESSE\u4E0D\u540C\u7684\u662F, \u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u53EF\u4EE5\u76F8\u4E92\u901A\u4FE1."}),"\n"]}),"\n",(0,r.jsxs)(n.div,{className:"rspress-directive tip",children:[(0,r.jsx)(n.div,{className:"rspress-directive-title",children:"\u8BF4\u660E"}),(0,r.jsx)(n.div,{className:"rspress-directive-content",children:(0,r.jsxs)(n.p,{children:["\u8FD9\u91CC\u501F\u52A9 ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ws"})})," \u8FD9\u4E2A\u5E93\u6765\u5B9E\u73B0."]})})]}),"\n",(0,r.jsxs)(n.h3,{id:"\u5B9E\u73B0-1",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B9E\u73B0-1",children:"#"}),"\u5B9E\u73B0"]}),"\n",(0,r.jsxs)(n.h4,{id:"\u540E\u7AEFnodejs-1",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u540E\u7AEFnodejs-1",children:"#"}),"\u540E\u7AEF(nodejs)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"{3,6,9}",children:'const WebSocket = require("ws");\n\nconst wss = new WebSocket.Server({ port: 3001 });\n\nwss.on("connection", (ws) => {\n  ws.on("message", (message) => {\n    console.log(\'\u63A5\u6536\u5230\u5BA2\u6237\u7AEF\u6D88\u606F,\' + message);\n  });\n  ws.send("\u7ED9\u5BA2\u6237\u7AEF\u53D1\u9001\u6D88\u606F");\n});\n\nconsole.log("ws\u670D\u52A1\u5DF2\u542F\u52A8, \u7AEF\u53E3\u53F7: 3001");\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u542F\u52A8\u4E00\u4E2Aws\u670D\u52A1\u975E\u5E38\u7B80\u5355, \u5B9E\u9645\u4E0A\u5C31\u662F\u4E24\u4E2A\u52A8\u4F5C(\u5B9E\u9645\u4E0A\u524D\u7AEF\u4E5F\u662F\u5982\u6B64), ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"\u76D1\u542C"})})," / ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"\u53D1\u9001"})})]}),"\n",(0,r.jsxs)(n.h4,{id:"\u524D\u7AEF-1",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u524D\u7AEF-1",children:"#"}),"\u524D\u7AEF"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",meta:"{2,8}",children:"const ws = new WebSocket('ws://localhost:3001')\nws.addEventListener('message', (data) => {\n    console.log('\u63A5\u6536\u5230\u6D88\u606F', data.data)\n})\n\nsetTimeout(() => {\n    // \u53D1\u9001\u6D88\u606F\n    ws.send(JSON.stringify({ name: 'MMX ' }))\n}, 1000)\n\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"\u6548\u679C",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6548\u679C",children:"#"}),"\u6548\u679C"]}),"\n",(0,r.jsx)("img",{src:a})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(c,e)})):c(e)}let l=h;h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["views%2Fnote%2FserverNotify.mdx"]={toc:[{id:"server-sent-events-sse",text:"Server-Sent Events (SSE)",depth:2},{id:"\u5B9E\u73B0",text:"\u5B9E\u73B0",depth:3},{id:"\u540E\u7AEFnodejs",text:"\u540E\u7AEF(nodejs)",depth:4},{id:"\u524D\u7AEF",text:"\u524D\u7AEF",depth:4},{id:"\u6848\u4F8B\u5730\u5740",text:"\u6848\u4F8B\u5730\u5740",depth:3},{id:"websocket",text:"websocket",depth:2},{id:"\u5B9E\u73B0-1",text:"\u5B9E\u73B0",depth:3},{id:"\u540E\u7AEFnodejs-1",text:"\u540E\u7AEF(nodejs)",depth:4},{id:"\u524D\u7AEF-1",text:"\u524D\u7AEF",depth:4},{id:"\u6548\u679C",text:"\u6548\u679C",depth:4}],title:"\u670D\u52A1\u7AEF\u901A\u77E5",frontmatter:{}}}}]);